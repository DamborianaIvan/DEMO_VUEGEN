define(["CommonUtilities"],function(e){var t,n,i,o=2e3,r={overlay:{position:"fixed",top:"0px","background-color":"#FFFFFF",width:"100vw",height:"100vh","z-index":9999999,transition:"opacity .3s ease",opacity:0},banner:{"background-color":"#27292D",height:"72px",position:"relative"},redirectMessage:{margin:"130px 24px 0px","text-align":"center",color:"#584F8C",font:"normal normal 24.0px Lato-Regular"},redirectMessageText:{"max-width":"470px",margin:"auto","font-weight":"bold"},redirectMessageSubtext:{color:"#666666",margin:"14px auto 32px","font-size":"16px"},loader:{"margin-top":"48px","text-align":"center"},bcclLogo:{position:"absolute",left:"33px",bottom:"0px",width:"126px"},backButton:{width:"186px",height:"44px",cursor:"pointer"}},c='         <div style=${overlay}>             <div style=${banner}>                <img src="desktopweb/images/logo_bccl.png" style=${bcclLogo} />            </div>             <div style=${redirectMessage} >                 <div style=${redirectMessageText}>'+kony.i18n.getLocalizedString("i18n.bccl.coliving.redirectMessage")+'</div>            </div>            <div style=${loader} >                 <img src="desktopweb/images/loader_loop.gif"/>            </div>        </div>',a='         <div style=${overlay}>             <div style=${banner}>                <img src="desktopweb/images/logo_bccl.png" style=${bcclLogo} />            </div>             <div style=${redirectMessage} >                 <div style=${redirectMessageText}>'+kony.i18n.getLocalizedString("i18n.bccl.coliving.redirectErrorMessage")+"</div>                <div style=${redirectMessageSubtext}>"+kony.i18n.getLocalizedString("i18n.bccl.coliving.redirectErrorSubtitle")+'</div>            </div>            <div class="cntmiddlecenteralign">                 <button id="redirectingErrorBackButton" style=${backButton} class="sknBtnPrimary">'+bccl.i18n.BACK()+"</button>            </div>        </div>";function l(e){return e.match(/\${(.*?)}/g).forEach(function(t){var n,i;e=e.split(t).join((n=t.substring(2,t.length-1),'"'+(i=JSON.stringify(r[n])).substring(1,i.length-1).split(",").join(";").split('"').join("")+'"'))}),e}function s(n){u()&&t.close(),e.isApp()?cordova.InAppBrowser.open(n,"_system"):t=window.open(n,"_blank");var o=setInterval(function(){u()||(i&&(i(),i=null),clearInterval(o))},1500);g()}function d(){u()&&(t.close(),t=null)}function g(){!e.isApp()&&u()&&t.focus()}function u(){return t&&!t.closed}function p(e){i=e}function v(e){var t;(n=document.createElement("div")).innerHTML=(t=c,"error"==e&&(t=a),l(t)),document.body.appendChild(n),setTimeout(function(){n.children[0].style.opacity=1},0)}function f(){b(),v("error"),document.getElementById("redirectingErrorBackButton").onclick=b}function b(){n&&(n.children[0].style.opacity=0,setTimeout(n.remove.bind(n),500))}function m(e,t){v();var n,i,r,c=applicationManager.getBcclConfigurationManager().getBcclConf("COLIVING_MIN_REDIRECTING_MSG_DURATION")||o,a=Date.now();n=e,i=function(e){var n=applicationManager.getBcclConfigurationManager().getBcclConf("COLIVING_LEGACY_URL");if(n){n+="userLogin.do?reqCode=irAlComponente",n+="&tokenParam="+e;var i=Date.now()-a;setTimeout(function(){b(),t(n)},c-i)}else f()},r=f,applicationManager.getAuthManager().getTokenConexionBancaActual({codigoComponente:n},function(e){try{i(e[0].token)}catch(e){r()}},r)}return{open:function(e){return m(e,s),{close:d,focus:g,onClose:p}}}});